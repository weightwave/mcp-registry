# CVE-2024-0195: Spider-Flow Code Injection Vulnerability

## Overview
A critical code injection vulnerability has been discovered in spider-flow version 0.4.3, specifically affecting the `FunctionService.saveFunction` method in the `src/main/java/org/spiderflow/controller/FunctionController.java` file. This vulnerability allows for remote code execution through manipulation of function inputs.

## Vulnerability Details
- **CVE ID**: CVE-2024-0195
- **Affected Version**: spider-flow 0.4.3
- **Vulnerability Type**: Code Injection (CWE-94)
- **CVSS v3.1 Base Score**: 9.8 CRITICAL
- **Attack Vector**: Remote
- **Affected Component**: FunctionService.saveFunction
- **Disclosure Date**: January 2, 2024

## Technical Analysis
The vulnerability exists in spider-flow's function execution mechanism, specifically in how the application handles JavaScript code execution through the Nashorn engine. The vulnerability stems from:

1. **Input Validation Issue**: The application fails to properly validate and sanitize user-supplied JavaScript code
2. **Execution Context**: Code is executed through the Nashorn script engine without proper sandboxing
3. **Privilege Level**: The executed code runs with the same privileges as the spider-flow application

### Vulnerable Component Analysis
The vulnerability involves multiple components:
- `FunctionController.java`: Handles HTTP requests for function management
- `FunctionService.java`: Manages function storage and execution
- `ScriptManager.java`: Responsible for JavaScript code execution via Nashorn

### Attack Vector
An attacker can exploit this vulnerability by:
1. Submitting malicious JavaScript code through the `/function/save` endpoint
2. Leveraging Java's Runtime.getRuntime().exec() for command execution
3. Bypassing intended function restrictions

## Impact
The vulnerability can lead to:
- Remote Code Execution (RCE)
- Information disclosure
- System compromise
- Unauthorized access to underlying system
- Data breach potential

## Exploitation Prerequisites
- Network access to target spider-flow instance
- No authentication required (default configuration)
- Target running spider-flow version 0.4.3

## Mitigation Strategies
Currently, no official patch is available. Recommended mitigations include:
1. Upgrade to a newer version when available
2. Implement strict input validation
3. Restrict access to function management endpoints
4. Deploy Web Application Firewall (WAF)
5. Monitor for suspicious JavaScript function submissions

## POC Exploit Usage
```bash
python3 exploit.py -u <target_url> -c <command>
```

### Example
```bash
python3 exploit.py -u http://localhost:8088 -c "id"
```

## Disclaimer
This POC is for security research and testing purposes only. Do not use against systems without explicit permission.

## References
1. National Vulnerability Database: [CVE-2024-0195](https://nvd.nist.gov/vuln/detail/CVE-2024-0195)
2. VulDB Entry: [VDB-249510](https://vuldb.com/?id.249510)
3. MITRE CWE-94: [Improper Control of Generation of Code](https://cwe.mitre.org/data/definitions/94.html)
4. MITRE ATT&CK: [T1059 - Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059/)

## Timeline
- 2024-01-02: Vulnerability disclosed
- 2024-01-02: CVE assigned
- 2024-01-22: Technical details published

## Author
This analysis was compiled by Devin for WeightWave Security Team.
